---
title: "The Statistics of Airlines"
subtitle: "Cancellations and Delays"
format: html
editor: visual
execute:
  echo: false
---

## Introduction and data

[CORGIS Datasets Project (vt.edu)](https://think.cs.vt.edu/corgis/csv/airlines/)

This data is from the CORGIS Data Set Project. This is the second version of this data set, and it was created by Austin Cory Bart. The data set was created on March 27, 2015. There is little information on how the data was collected; however, it is likely that the statistician took a retrospective approach, looking at past monthly records for different airports across the United States starting in 2003. Each observation is based on an airport code (shorthand for the airport's full name) and a specific time (year/month). For each observation, there are different variables to identify how many flights were delayed (and for what reason), cancelled, diverted, or on time.

Based on this data set our research question is: **Of the top five busiest airports in the U.S.,** **when and where are there the most flight delays and/or cancellations?** We want to answer this research question because flight delays and cancellations often give passengers grief and stress at all different times of the year. However, our question explores whether there is a specific time of year when flights are particularly prone to delays and cancellations and for what reason. In turn, this would help those looking to fly to know how to best plan for trips that might be impacted by flight changes. Working to understand why such issues occur would also be crucial, both in determining whether certain cancellations or delays can be avoided and in providing some perspective to passengers who have struggled with flight plans in the past.

Based on the past literature on the times of year flights are subject to the most cancellations and delays, we hypothesize that the time most prone to flight cancellations and delays is during the summer months (June through August) due to late aircrafts as so many people choose to fly during this time.

Published on July 1st, 2022, the NYT article "Understanding the Summer Air Travel Mess" discusses the challenges faced by travelers during the summer months due to mass delays and cancellations. As a result of being the busiest time of the year, factors such as weather, staffing shortages, and equipment issues have a much more significant impact on schedule disruption. Just last year, low-cost carriers like JetBlue and Spirit canceled 10.3 and 9 percent of flights in April. The article also provides advice on how to minimize the impact of flight delays: book direct flights and choose early morning departures. It's also smart to avoid flying during weekends. Most importantly, though, "never book the last flight of the day." Additionally, Murphy writes about the implications these cancellations have on airlines, damaging them both financially and reputation wise. New technologies may be implemented, but, at "the heart of the issue," airlines respond to supply and demand, increasing flights when people travel more.

Murphy, Heather. "Understanding the Summer Air Travel Mess." The New York Times, The New York Times, 1 July 2022, https://www.nytimes.com/2022/07/01/travel/summer-travel-flight-delays-cancellations.html.

## Methodology

We are utilizing mostly quantitative variables in this research, which the exception of the month data, airline information, and airport information (categorical). Quantitative variables used will include the number of flights delayed and cancelled for a variety of reasons at different airports across the country.

```{r}
#| label: load-pkgs
#| message: false

library(tidyverse)
library(tidymodels)
```

```{r}
#| label: load-data

airlines <- read_csv("airlines.csv", show_col_types = FALSE)
```

Our research question first requires us to create a new variable determining in what season observations were recorded. The winter months include December, January, and February; the spring months include March, April, and May; the summer months include June, July, and August; and the fall months include September, October, and November.

```{r}
#| label: add-season

winter <- c(12, 1, 2)
spring <- c(3, 4, 5)
summer <- c(6, 7, 8)

airlines_season <- airlines |>
  mutate(season = if_else(Time.Month %in% winter, "Winter",
                  if_else(Time.Month %in% spring,"Spring",
                  if_else(Time.Month %in% summer, "Summer", "Fall"))))
```

Since we are focusing on the top five airports in the United States, we also wanted to filter out the data to only include observations for those five airports.

```{r}
#| label: filter-pop-airports

airlines_season <- airlines_season |>
  filter(Airport.Code == "ATL" |
         Airport.Code == "LAX" |
         Airport.Code == "ORD" |
         Airport.Code ==  "DFW" |
         Airport.Code == "DEN")
```

This visualization below displays the flights cancelled at each of the top five busiest airports in the United States by season.

```{r}
#| label: cancel-by-season

airlines_season |>
  ggplot(
    aes(x = season, y = Statistics.Flights.Cancelled)
  ) +
  geom_point() +
  facet_wrap(~Airport.Code) +
  labs(x = "Season",
       y = "# of Flights Cancelled",
       title = "Flights Cancelled by Time of Year")
```

This visualization below displays the flights delayed at each of the top five busiest airports in the United States by season.

```{r}
#| label: delay-by-season
airlines_season |>
  ggplot(
    aes(x = season, y = Statistics.Flights.Delayed)
  ) +
  geom_point() +
  facet_wrap(~Airport.Code) +
  labs(x = "Season",
       y = "# of Flights Delayed",
       title = "Flights Delayed by Time of Year")

```

Looking at these visualizations, we noticed that almost all of the airports had the most cancellations during the winter months, with ORD (O'Hare) having the most cancellations during the winter months. Also, we observed that highest number of delays across the five airports occur during the summer and winter months, with ATL (Atlanta) having the most delays during the summer months and ORD (O'Hare) having the most delays during the winter months. However, we wanted to confirm such findings by looking at the mean number of delays and cancellations at each airport and during each season.

```{r}
#| label: airport-means
airlines_season |>
  filter(Airport.Code == "ATL") |>
  summarize(atl_mean_cancel = mean(Statistics.Flights.Cancelled),
            atl_mean_delay = mean(Statistics.Flights.Delayed))

airlines_season |>
  filter(Airport.Code == "DEN") |>
  summarize(den_mean_cancel = mean(Statistics.Flights.Cancelled),
            den_mean_delay = mean(Statistics.Flights.Delayed))

airlines_season |>
  filter(Airport.Code == "DFW") |>
  summarize(dfw_mean_cancel = mean(Statistics.Flights.Cancelled),
            dfw_mean_delay = mean(Statistics.Flights.Delayed))

airlines_season |>
  filter(Airport.Code == "LAX") |>
  summarize(lax_mean_cancel = mean(Statistics.Flights.Cancelled),
            lax_mean_delay = mean(Statistics.Flights.Delayed))

airlines_season |>
  filter(Airport.Code == "ORD") |>
  summarize(ord_mean_cancel = mean(Statistics.Flights.Cancelled),
            ord_mean_delay = mean(Statistics.Flights.Delayed))

```

Examining this mean data, on average, O'Hare has the highest number of flight cancellations and Atlanta has the highest number of flight delays.

```{r}
#| label: season-means

airlines_season |>
  filter(season == "Winter") |>
  summarize(winter_mean_cancel = mean(Statistics.Flights.Cancelled),
            winter_mean_delay = mean(Statistics.Flights.Delayed))

airlines_season |>
  filter(season == "Spring") |>
  summarize(spring_mean_cancel = mean(Statistics.Flights.Cancelled),
            spring_mean_delay = mean(Statistics.Flights.Delayed))

airlines_season |>
  filter(season == "Summer") |>
  summarize(summer_mean_cancel = mean(Statistics.Flights.Cancelled),
            summer_mean_delay = mean(Statistics.Flights.Delayed))

airlines_season |>
  filter(season == "Fall") |>
  summarize(fall_mean_cancel = mean(Statistics.Flights.Cancelled),
            fall_mean_delay = mean(Statistics.Flights.Delayed))
```

Examining this mean data, on average, the highest number of flight cancellations occur during the winter months while the highest number of flight delays occur during the summer months.

To answer our research question, we are using a linear regession model. A linear regression model is most appropriate for our data because we are utilizing a categorical variable (seasons) to help answer our research question. We will also utilize a multiple linear regression model to estimate the relationship between a quantitative variable (either the number of delays or the number of cancellations) and two explanatory variables (both seasons and airport codes). In this case, multiple linear regression is helpful because multiple variables are connected to the output (in this case, the number of flight delays or cancellations). Finally, we will utilize r-squared and AIC to determine whether the interactive models or the simple models are better fits for the data.

## Results

```{r}
#| label: linear-reg-delayed

model1_delayed <- linear_reg() |>
  set_engine("lm") |>
  fit(Statistics.Flights.Delayed ~ season, data = airlines_season)

model1_delayed |>
  tidy()

```

```{r}
#| label: linear-reg-cancelled

model1_cancelled <- linear_reg() |>
  set_engine("lm") |>
  fit(Statistics.Flights.Cancelled ~ season, data = airlines_season)

model1_cancelled |>
  tidy()
```

```{r}
#| label: visualize-linear-reg-delayed

airlines_season |>
  ggplot(
    aes(x = season, y = Statistics.Flights.Delayed)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Season",
       y = "Number of Flights Delayed",
       title = "Number of Flights Delayed by Season")

```

```{r}
#| label: visualize-lin-reg-cancelled

airlines_season |>
  ggplot(
    aes(x = season, y = Statistics.Flights.Cancelled)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Season",
       y = "Number of Flights Canceled",
       title = "Number of Flights Canceled by Season")
```

```{r}
#| label: lin-reg-airport-delay

model2_delayed <- linear_reg() |>
  set_engine("lm") |>
  fit(Statistics.Flights.Delayed ~ season * Airport.Code, data = airlines_season)

model2_delayed |>
  tidy()
```

At the Atlanta airport in the fall, we expect there to be about 6021 delayed flights. From this data, we do notice that the season with the highest number of flight delays varies between airport. For Atlanta, we observe that the coefficient associated with the summer season is the highest, indicating that summer has the highest number of delays in Atlanta. However, it is important to note that not all five of the airports have the highest number of delays in the summer.

```{r}
#| label: lin-reg-airport-cancel

model2_cancelled <- linear_reg() |>
  set_engine("lm") |>
  fit(Statistics.Flights.Cancelled ~ season * Airport.Code, data = airlines_season)

model2_cancelled |>
  tidy()
```

At the Atlanta airport in the fall, we expect there to be about 362 delayed flights. From this data, we do notice that the season with the highest number of flight cancellations varies between airport. For Atlanta, we observe that the coefficient associated with the winter season is the highest, indicating that winter has the highest number of cancellations in Atlanta. However, it is important to note that not all five of the airports have the highest number of cancellations in the winter.

```{r}
#| label: comp-cancel-models

glance(model1_delayed)$r.squared
glance(model2_delayed)$r.squared

glance(model1_delayed)$AIC
glance(model2_delayed)$AIC

glance(model1_cancelled)$r.squared
glance(model2_cancelled)$r.squared

glance(model1_cancelled)$AIC
glance(model2_cancelled)$AIC
```

Comparing the linear regression model without airport codes (model1) for flight delays with the interactive regression model that takes airport codes as a second variable (model2) for flight delays, we observed that the interactive model is a better representation of the data than the simple model. The r-squared for the interactive model is closer to one than the simple model, and the AIC for the interactive model is smaller than the AIC for the simple model, both indicating that the second model, the interactive model, better represents this data.

We found the same results comparing the two models (the simple model and the interactive model) for the flight cancellation data. The r-squared for the interactive cancellation model is closer to one than the simple cancellation model, adn the AIC for the intractive cancellation model is lower than the AIC for the simple cancellation model.

While our original question specifically focused on the impact of seasons on cancellations and delays, it is crucial to recognize that the airport also has a significant impact on cancellations and delays. Further research must be conducted to continue to examine the relationship between airports and cancellations or delays.
